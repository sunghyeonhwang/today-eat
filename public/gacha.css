/* ==========================================
   Gacha Animation System
   Material Design 3 Expressive Motion
   ========================================== */

/* ===================
   Gacha Animation Tokens
   =================== */
:root {
  /* Motion Timing Functions - M3 Expressive */
  --easing-standard: cubic-bezier(0.2, 0, 0, 1);
  --easing-emphasized: cubic-bezier(0.2, 0, 0, 1);
  --easing-emphasized-decelerate: cubic-bezier(0.05, 0.7, 0.1, 1);
  --easing-emphasized-accelerate: cubic-bezier(0.3, 0, 0.8, 0.15);
  --easing-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);

  /* Duration Tokens */
  --duration-short1: 50ms;
  --duration-short2: 100ms;
  --duration-short3: 150ms;
  --duration-short4: 200ms;
  --duration-medium1: 250ms;
  --duration-medium2: 300ms;
  --duration-medium3: 350ms;
  --duration-medium4: 400ms;
  --duration-long1: 450ms;
  --duration-long2: 500ms;
  --duration-long3: 550ms;
  --duration-long4: 600ms;
  --duration-extra-long1: 700ms;
  --duration-extra-long2: 800ms;
  --duration-extra-long3: 900ms;
  --duration-extra-long4: 1000ms;
}

/* ===================
   Gacha Slot Machine Container
   =================== */
.gacha-machine {
  position: relative;
  perspective: 1000px;
}

/* Slot Machine Window */
.gacha-slot-window {
  position: relative;
  width: 192px;
  height: 192px;
  border-radius: 24px;
  background: linear-gradient(135deg, #FFF09D 0%, #FFE66D 100%);
  box-shadow:
    0 20px 40px -10px rgba(255, 230, 109, 0.5),
    0 10px 20px -5px rgba(0, 0, 0, 0.1),
    inset 0 2px 4px rgba(255, 255, 255, 0.8);
  overflow: hidden;
  margin: 0 auto 32px;
}

/* Inner Frame Border */
.gacha-slot-window::before {
  content: '';
  position: absolute;
  inset: 6px;
  border: 3px dashed rgba(255, 107, 53, 0.3);
  border-radius: 18px;
  pointer-events: none;
  z-index: 10;
}

/* Shine Effect */
.gacha-slot-window::after {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: linear-gradient(
    45deg,
    transparent 30%,
    rgba(255, 255, 255, 0.4) 50%,
    transparent 70%
  );
  transform: rotate(45deg) translateX(-100%);
  pointer-events: none;
  z-index: 5;
}

/* ===================
   Slot Reel System
   =================== */
.gacha-reel-container {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}

.gacha-reel {
  display: flex;
  flex-direction: column;
  align-items: center;
  transition: transform var(--duration-medium4) var(--easing-emphasized-decelerate);
}

.gacha-reel-item {
  width: 120px;
  height: 120px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 64px;
  flex-shrink: 0;
}

/* ===================
   Spinning Animation
   =================== */
.gacha-machine--spinning .gacha-slot-window {
  animation: slotMachineShake 0.1s linear infinite;
}

.gacha-machine--spinning .gacha-slot-window::after {
  animation: slotShine 0.8s ease-in-out infinite;
}

.gacha-machine--spinning .gacha-reel {
  animation: slotSpin 0.15s linear infinite;
}

@keyframes slotMachineShake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-2px); }
  75% { transform: translateX(2px); }
}

@keyframes slotShine {
  0% { transform: rotate(45deg) translateX(-100%); }
  100% { transform: rotate(45deg) translateX(100%); }
}

@keyframes slotSpin {
  0% { transform: translateY(0); }
  100% { transform: translateY(-120px); }
}

/* ===================
   Stopping Animation (Decelerate)
   =================== */
.gacha-machine--stopping .gacha-slot-window {
  animation: slotMachineShake 0.15s linear 2;
}

.gacha-machine--stopping .gacha-reel {
  animation: slotSpinDecelerate 0.8s var(--easing-emphasized-decelerate) forwards;
}

@keyframes slotSpinDecelerate {
  0% { transform: translateY(0); }
  20% { transform: translateY(-240px); }
  40% { transform: translateY(-400px); }
  60% { transform: translateY(-480px); }
  80% { transform: translateY(-500px); }
  100% { transform: translateY(-480px); }
}

/* ===================
   Result Reveal Animation
   =================== */
.gacha-machine--revealed .gacha-slot-window {
  animation: resultBounce 0.6s var(--easing-bounce);
  box-shadow:
    0 30px 60px -15px rgba(255, 230, 109, 0.6),
    0 15px 30px -10px rgba(0, 0, 0, 0.15),
    inset 0 2px 4px rgba(255, 255, 255, 0.8);
}

.gacha-machine--revealed .gacha-slot-window::after {
  animation: celebrationShine 1s ease-in-out;
}

/* 결과 표시 시 reel 중앙 정렬 */
.gacha-machine--revealed .gacha-reel {
  transform: translateY(0) scale(1) !important;
  transition: transform 0.3s ease-out, opacity 0.3s ease-out !important;
}

.gacha-machine--revealed .gacha-reel-item {
  display: none;
}

.gacha-machine--revealed .gacha-reel-item.selected {
  display: flex;
  animation: revealBounce 0.4s ease-out;
}

@keyframes revealBounce {
  0% { transform: scale(0.8); opacity: 0; }
  50% { transform: scale(1.15); }
  100% { transform: scale(1); opacity: 1; }
}

@keyframes resultBounce {
  0% { transform: scale(1); }
  30% { transform: scale(1.15); }
  50% { transform: scale(0.95); }
  70% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

@keyframes celebrationShine {
  0% { transform: rotate(45deg) translateX(-200%); }
  100% { transform: rotate(45deg) translateX(200%); }
}

/* ===================
   Gacha Button States
   =================== */
.gacha-btn {
  position: relative;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 16px 48px;
  background: linear-gradient(135deg, #FF6B35 0%, #E55A2B 100%);
  color: white;
  font-size: 18px;
  font-weight: 700;
  border-radius: 9999px;
  border: none;
  cursor: pointer;
  box-shadow:
    0 10px 30px -5px rgba(255, 107, 53, 0.5),
    0 5px 15px -3px rgba(0, 0, 0, 0.1);
  transition: all var(--duration-medium2) var(--easing-emphasized);
  overflow: hidden;
}

.gacha-btn::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(
    180deg,
    rgba(255, 255, 255, 0.2) 0%,
    transparent 50%
  );
  pointer-events: none;
}

.gacha-btn:hover {
  transform: scale(1.05);
  box-shadow:
    0 15px 40px -5px rgba(255, 107, 53, 0.6),
    0 8px 20px -3px rgba(0, 0, 0, 0.15);
}

.gacha-btn:active {
  transform: scale(0.98);
}

/* Button Spinning State */
.gacha-btn--spinning {
  pointer-events: none;
  animation: buttonPulse 0.5s ease-in-out infinite;
}

@keyframes buttonPulse {
  0%, 100% { box-shadow: 0 10px 30px -5px rgba(255, 107, 53, 0.5); }
  50% { box-shadow: 0 15px 40px -5px rgba(255, 107, 53, 0.7); }
}

/* ===================
   Screen Transition Effects
   =================== */

/* Fade & Scale Transition */
.screen-transition-enter {
  opacity: 0;
  transform: scale(0.95);
}

.screen-transition-enter-active {
  opacity: 1;
  transform: scale(1);
  transition:
    opacity var(--duration-medium3) var(--easing-emphasized-decelerate),
    transform var(--duration-medium3) var(--easing-emphasized-decelerate);
}

.screen-transition-exit {
  opacity: 1;
  transform: scale(1);
}

.screen-transition-exit-active {
  opacity: 0;
  transform: scale(1.05);
  transition:
    opacity var(--duration-short4) var(--easing-emphasized-accelerate),
    transform var(--duration-short4) var(--easing-emphasized-accelerate);
}

/* Slide Up Transition (for result screen) */
.slide-up-enter {
  opacity: 0;
  transform: translateY(40px);
}

.slide-up-enter-active {
  opacity: 1;
  transform: translateY(0);
  transition:
    opacity var(--duration-medium4) var(--easing-emphasized-decelerate),
    transform var(--duration-medium4) var(--easing-emphasized-decelerate);
}

/* ===================
   Result Card Animation
   =================== */
.gacha-result-container {
  animation: resultContainerReveal 0.6s var(--easing-emphasized-decelerate);
}

@keyframes resultContainerReveal {
  0% {
    opacity: 0;
    transform: translateY(30px) scale(0.9);
  }
  100% {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

/* Badge Pop Animation */
.gacha-result-badge {
  animation: badgePop 0.5s var(--easing-bounce) 0.2s both;
}

@keyframes badgePop {
  0% {
    opacity: 0;
    transform: scale(0) rotate(-10deg);
  }
  60% {
    transform: scale(1.2) rotate(5deg);
  }
  100% {
    opacity: 1;
    transform: scale(1) rotate(0deg);
  }
}

/* Restaurant Image Reveal */
.gacha-result-image {
  animation: imageReveal 0.5s var(--easing-emphasized-decelerate) 0.1s both;
}

@keyframes imageReveal {
  0% {
    opacity: 0;
    transform: scale(0.8) rotateY(-15deg);
  }
  100% {
    opacity: 1;
    transform: scale(1) rotateY(0deg);
  }
}

/* Info Stagger Animation */
.gacha-result-name {
  animation: infoSlideUp 0.4s var(--easing-emphasized-decelerate) 0.25s both;
}

.gacha-result-category {
  animation: infoSlideUp 0.4s var(--easing-emphasized-decelerate) 0.3s both;
}

.gacha-result-info {
  animation: infoSlideUp 0.4s var(--easing-emphasized-decelerate) 0.35s both;
}

.gacha-result-actions {
  animation: actionsReveal 0.5s var(--easing-emphasized-decelerate) 0.45s both;
}

@keyframes infoSlideUp {
  0% {
    opacity: 0;
    transform: translateY(20px);
  }
  100% {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes actionsReveal {
  0% {
    opacity: 0;
    transform: translateY(30px) scale(0.9);
  }
  100% {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

/* ===================
   Confetti Celebration
   =================== */
.confetti-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  overflow: hidden;
  z-index: 100;
}

.confetti {
  position: absolute;
  width: 10px;
  height: 10px;
  opacity: 0;
}

.confetti--circle {
  border-radius: 50%;
}

.confetti--square {
  border-radius: 2px;
}

.confetti--triangle {
  width: 0;
  height: 0;
  border-left: 5px solid transparent;
  border-right: 5px solid transparent;
  border-bottom: 10px solid currentColor;
}

@keyframes confettiFall {
  0% {
    opacity: 1;
    transform: translateY(-20px) rotate(0deg);
  }
  100% {
    opacity: 0;
    transform: translateY(100vh) rotate(720deg);
  }
}

/* ===================
   Particle Burst Effect
   =================== */
.particle-burst {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 200px;
  height: 200px;
  margin: -100px 0 0 -100px;
  pointer-events: none;
}

.particle {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  opacity: 0;
}

.particle-burst--active .particle {
  animation: particleExplode 0.8s var(--easing-emphasized-decelerate) forwards;
}

@keyframes particleExplode {
  0% {
    opacity: 1;
    transform: translate(-50%, -50%) scale(0);
  }
  50% {
    opacity: 1;
  }
  100% {
    opacity: 0;
    transform: translate(var(--tx), var(--ty)) scale(1);
  }
}

/* ===================
   Haptic Feedback Visual
   =================== */
.haptic-ripple {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 100%;
  height: 100%;
  border-radius: inherit;
  background: radial-gradient(circle, rgba(255, 255, 255, 0.4) 0%, transparent 70%);
  transform: translate(-50%, -50%) scale(0);
  pointer-events: none;
}

.haptic-ripple--active {
  animation: hapticRipple 0.4s var(--easing-standard);
}

@keyframes hapticRipple {
  0% {
    transform: translate(-50%, -50%) scale(0);
    opacity: 1;
  }
  100% {
    transform: translate(-50%, -50%) scale(2);
    opacity: 0;
  }
}

/* ===================
   Loading Spinner for Gacha
   =================== */
.gacha-spinner {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-top-color: white;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* ===================
   Emoji Slot Items
   =================== */
.emoji-slot-items {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.emoji-slot-item {
  font-size: 72px;
  line-height: 1;
  padding: 24px 0;
  filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.1));
}

/* ===================
   Retry Button Animation
   =================== */
.retry-btn {
  position: relative;
  overflow: hidden;
}

.retry-btn:hover .retry-icon {
  animation: retryIconSpin 0.6s var(--easing-emphasized);
}

@keyframes retryIconSpin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* ===================
   Select Button Celebration
   =================== */
.select-btn--celebrating {
  animation: celebrateButton 0.5s var(--easing-bounce);
}

@keyframes celebrateButton {
  0%, 100% { transform: scale(1); }
  25% { transform: scale(1.1); }
  50% { transform: scale(0.95); }
  75% { transform: scale(1.05); }
}

/* ===================
   Adaptive Layout - Medium/Large Screens
   =================== */
@media (min-width: 600px) {
  .gacha-slot-window {
    width: 240px;
    height: 240px;
  }

  .gacha-reel-item {
    width: 160px;
    height: 160px;
    font-size: 80px;
  }

  .emoji-slot-item {
    font-size: 96px;
  }
}

/* Tablet & Desktop: Side Panel Layout */
@media (min-width: 840px) {
  .gacha-layout {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 32px;
    align-items: center;
    min-height: 60vh;
  }

  .gacha-machine-panel {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  .gacha-info-panel {
    padding: 32px;
    background: white;
    border-radius: 24px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  }
}

/* ===================
   Reduced Motion Support
   =================== */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }

  .gacha-machine--spinning .gacha-reel {
    animation: none;
  }

  .gacha-machine--spinning .gacha-slot-window {
    animation: none;
  }
}

/* ===================
   Dark Mode Support
   =================== */
@media (prefers-color-scheme: dark) {
  .gacha-slot-window {
    background: linear-gradient(135deg, #E6CF5A 0%, #D4BC4A 100%);
    box-shadow:
      0 20px 40px -10px rgba(230, 207, 90, 0.3),
      0 10px 20px -5px rgba(0, 0, 0, 0.3);
  }

  .gacha-info-panel {
    background: #1F2937;
  }
}

/* ===================
   Enhanced Gacha Animations
   =================== */

/* Anticipation Effect (Pull-back before spin) */
.gacha-machine--anticipation .gacha-slot-window {
  animation: anticipationPullBack 0.5s var(--easing-emphasized);
}

@keyframes anticipationPullBack {
  0% { transform: scale(1); }
  50% { transform: scale(0.95); }
  100% { transform: scale(1); }
}

/* Drum Roll Effect */
.gacha-drum-roll {
  position: absolute;
  inset: 0;
  border-radius: inherit;
  background:
    radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.3) 0%, transparent 50%),
    radial-gradient(circle at 70% 70%, rgba(255, 107, 53, 0.2) 0%, transparent 50%);
  animation: drumRollPulse 0.3s ease-in-out infinite;
  pointer-events: none;
  z-index: 20;
}

@keyframes drumRollPulse {
  0%, 100% { opacity: 0.5; }
  50% { opacity: 1; }
}

/* Result Glow Effect */
.gacha-result-glow {
  position: absolute;
  inset: -20px;
  border-radius: 50%;
  background: radial-gradient(circle, rgba(255, 230, 109, 0.6) 0%, transparent 70%);
  animation: resultGlow 2s ease-out forwards;
  pointer-events: none;
  z-index: -1;
}

@keyframes resultGlow {
  0% {
    transform: scale(0);
    opacity: 1;
  }
  50% {
    transform: scale(1.5);
    opacity: 0.8;
  }
  100% {
    transform: scale(2);
    opacity: 0;
  }
}

/* Result Emoji Container Enhancement */
.gacha-result-emoji-container {
  position: relative;
  background: linear-gradient(135deg, #FFF5ED 0%, #FFFBF7 100%);
  border: 3px solid rgba(255, 107, 53, 0.2);
  transition: all 0.3s var(--easing-bounce);
}

.gacha-result-emoji-container:hover {
  transform: scale(1.05) rotate(2deg);
  box-shadow:
    0 20px 40px -10px rgba(255, 107, 53, 0.3),
    0 10px 20px -5px rgba(0, 0, 0, 0.1);
}

/* Address Animation */
.gacha-result-address {
  animation: addressSlideIn 0.5s var(--easing-emphasized-decelerate) 0.4s both;
}

@keyframes addressSlideIn {
  0% {
    opacity: 0;
    transform: translateY(15px);
  }
  100% {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Review Animation */
.gacha-result-review {
  animation: reviewSlideIn 0.6s var(--easing-emphasized-decelerate) 0.5s both;
}

@keyframes reviewSlideIn {
  0% {
    opacity: 0;
    transform: translateY(20px) scale(0.95);
  }
  100% {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

/* Small Spinner for Location Load Button */
.gacha-spinner-small {
  display: inline-block;
  width: 16px;
  height: 16px;
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-top-color: white;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

/* Enhanced Confetti with More Variety */
.confetti--star {
  width: 12px;
  height: 12px;
  background: none;
  clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
}

/* Winner Spotlight Effect */
.gacha-winner-spotlight {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: radial-gradient(circle at 50% 30%, transparent 0%, rgba(0, 0, 0, 0.3) 100%);
  pointer-events: none;
  z-index: 99;
  animation: spotlightFadeIn 0.5s ease-out;
}

@keyframes spotlightFadeIn {
  0% { opacity: 0; }
  100% { opacity: 1; }
}

/* Gacha Location Input Styling */
#gacha-location-section input:focus {
  border-color: #4ECDC4;
  box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.1);
}

/* Enhanced Slot Machine Border Glow During Spin */
.gacha-machine--spinning .gacha-slot-window {
  box-shadow:
    0 0 30px rgba(255, 230, 109, 0.5),
    0 20px 40px -10px rgba(255, 230, 109, 0.5),
    0 10px 20px -5px rgba(0, 0, 0, 0.1),
    inset 0 2px 4px rgba(255, 255, 255, 0.8);
}

/* Pulsing Effect on Result Badge */
.gacha-result-badge {
  animation: badgePop 0.5s var(--easing-bounce) 0.2s both,
             badgePulse 2s ease-in-out 0.7s infinite;
}

@keyframes badgePulse {
  0%, 100% {
    box-shadow: 0 0 0 0 rgba(255, 230, 109, 0.4);
  }
  50% {
    box-shadow: 0 0 20px 5px rgba(255, 230, 109, 0.6);
  }
}

/* Rainbow Border Animation for Special Result */
.gacha-result-special .gacha-result-emoji-container {
  background: linear-gradient(white, white) padding-box,
              linear-gradient(135deg, #FF6B35, #4ECDC4, #FFE66D, #FF6B35) border-box;
  border: 3px solid transparent;
  animation: rainbowBorder 3s linear infinite;
}

@keyframes rainbowBorder {
  0% {
    filter: hue-rotate(0deg);
  }
  100% {
    filter: hue-rotate(360deg);
  }
}

/* Floating Animation for Result Emoji */
.gacha-result-image {
  animation: imageReveal 0.5s var(--easing-emphasized-decelerate) 0.1s both,
             floatingEmoji 3s ease-in-out 0.6s infinite;
}

@keyframes floatingEmoji {
  0%, 100% {
    transform: translateY(0) scale(1);
  }
  50% {
    transform: translateY(-8px) scale(1.02);
  }
}

/* Button Ripple Effect */
[data-action="gacha"]::after {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: inherit;
  background: radial-gradient(circle at var(--x, 50%) var(--y, 50%),
              rgba(255, 255, 255, 0.3) 0%,
              transparent 50%);
  opacity: 0;
  transition: opacity 0.3s;
  pointer-events: none;
}

[data-action="gacha"]:active::after {
  opacity: 1;
}

/* Shake Animation for Retry Button on Hover */
[data-action="retry"]:hover {
  animation: retryShake 0.5s ease-in-out;
}

@keyframes retryShake {
  0%, 100% { transform: rotate(0deg); }
  25% { transform: rotate(-5deg); }
  75% { transform: rotate(5deg); }
}
